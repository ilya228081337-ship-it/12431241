# Приложение для транскрибации аудио с диаризацией

Веб-приложение для транскрибации аудиозаписей интервью с автоматическим распознаванием говорящих (диаризацией).

## Возможности

- Загрузка аудиофайлов любых форматов
- Автоматическая транскрибация с помощью Web Speech API (Google)
- Диаризация говорящих (ML алгоритмы для разделения на 2 спикера)
- Интерактивный плеер с синхронизацией текста и аудио
- Хранение истории транскрипций
- Удаление записей
- Экспорт в TXT, SRT, JSON
- Ускоренная транскрибация (1.5x скорость)

## Как использовать

1. **Регистрация/Вход**: Создайте аккаунт или войдите в существующий
2. **Загрузка аудио**: Перетащите аудиофайл в зону загрузки или выберите файл
   - Поддерживаются: MP3, WAV, M4A, OGG и другие форматы
3. **Транскрибация**: Нажмите "Начать транскрибацию" для обработки
   - Разрешите доступ к микрофону (необходимо для Web Speech API)
   - Аудио обрабатывается с ускорением 1.5x для быстрой обработки
   - Web Speech API распознает речь через виртуальный аудио поток
   - Происходит автоматическая диаризация с использованием ML-алгоритмов
4. **Просмотр результатов**: Результаты отобразятся с цветовой маркировкой говорящих:
   - Синий фон - интервьюер (обычно более низкий голос)
   - Зеленый фон - респондент (обычно более высокий голос)
5. **Навигация**: Кликайте на сегменты текста для перехода к соответствующему месту в аудио
6. **Экспорт**: Скачайте результаты в формате TXT, SRT или JSON

## Технологии

- **Frontend**: React 18, TypeScript, Vite, Tailwind CSS
- **Backend**: Supabase (PostgreSQL, Storage, Auth)
- **AI/ML**: Web Speech API (Google Cloud), собственная реализация speaker diarization
- **Аудио**: Web Audio API

## Требования

**Браузеры:**
- Chrome 90+ (рекомендуется)
- Edge 90+ (рекомендуется)
- Firefox: ограниченная поддержка Web Speech API
- Safari: ограниченная поддержка Web Speech API

**Система:**
- Стабильное интернет-соединение (для Web Speech API)
- Разрешение доступа к микрофону
- Минимум 4GB RAM

## Устранение проблем

### Доступ к микрофону запрещен
- Браузер заблокировал доступ к микрофону
- Решение: Откройте настройки сайта в браузере и разрешите доступ к микрофону
- В Chrome: кликните на иконку замка слева от адресной строки → Разрешения → Микрофон

### Ошибка "no-speech"
- Это нормально при обработке - приложение автоматически перезапускает распознавание
- Если появляется много раз подряд - возможно низкое качество аудио
- Приложение все равно завершит обработку и создаст результат
- Проверьте, что файл действительно содержит речь

### Ошибка "aborted"
- Это нормальное поведение при работе Web Speech API
- Приложение автоматически перезапускает распознавание
- Убедитесь, что у вас стабильное интернет-соединение

### Низкое качество транскрипции
- Используйте аудиофайлы с четкой речью
- Избегайте файлов с фоновым шумом
- Оптимальный формат: MP3, битрейт 128 kbps или выше
- Записи в тихих помещениях дают лучшие результаты

### Транскрипция не появляется после обработки
1. Проверьте, что вы разрешили доступ к микрофону
2. Откройте консоль браузера (F12) и проверьте наличие ошибок
3. Убедитесь, что используете Chrome или Edge
4. Попробуйте перезагрузить страницу и начать заново
5. Проверьте интернет-соединение
6. Даже если речь не распознана, должна появиться заглушка

## Рекомендации

- Используйте Chrome или Edge для максимальной совместимости с Web Speech API
- Для лучших результатов используйте аудио с четкой речью и минимальным фоновым шумом
- Убедитесь, что разрешен доступ к микрофону в настройках браузера
- Стабильное интернет-соединение обязательно для работы Web Speech API

## Диаризация

Используется продвинутая система разделения говорящих:

**Технология:**
- K-means кластеризация для разделения на 2 говорящих
- Анализ энергии сигнала (громкость)
- Оценка высоты тона (pitch) - основной индикатор
- Zero-Crossing Rate (характеристика тембра)
- Сглаживание переходов между говорящими
- Автоматическое определение интервьюера по низкой средней высоте голоса

## Разработка

```bash
# Установка зависимостей
npm install

# Запуск dev-сервера
npm run dev

# Сборка
npm run build
```

## Структура базы данных

**audio_recordings** - Загруженные аудиозаписи
- Метаданные файлов
- Статус обработки (pending/processing/completed/error)
- Привязка к пользователю

**transcriptions** - Результаты транскрибации
- Текст сегментов
- Временные метки (start_time, end_time)
- Привязка к говорящим (interviewer/interviewee)
- Confidence score

## Безопасность

- Row Level Security (RLS) для всех таблиц
- Пользователи видят только свои данные
- Аудиофайлы хранятся с привязкой к пользователю
- Защищенные URL для воспроизведения аудио

## Ограничения

**Web Speech API:**
- Требует постоянное интернет-соединение
- Зависит от сервисов Google Cloud
- Ограниченная поддержка в Firefox и Safari
- Качество зависит от внешних факторов
- Требует разрешение доступа к микрофону

**Диаризация:**
- Работает только для 2 говорящих
- Может путать похожие голоса
- Не идеальна для перекрывающихся голосов
